{"version":3,"sources":["../../src/pages/location/location.module.ts","../../src/pages/location/location.ts"],"names":[],"mappings":"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","file":"10.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { LocationPage } from './location';\n\n@NgModule({\n  declarations: [\n    LocationPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(LocationPage),\n  ],\n})\nexport class LocationPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/location/location.module.ts","import { Component, ViewChild, ElementRef, NgZone } from '@angular/core';\nimport { IonicPage, NavController, NavParams, ViewController, Platform } from 'ionic-angular';\nimport { Geolocation } from '@ionic-native/geolocation';\n\nimport { Observable } from 'rxjs/Observable';\nimport { Storage } from '@ionic/storage';\nimport { SpinnerProvider } from '../../providers/spinner/spinner'\nimport { MapProvider } from '../../providers/map/map';\n\ndeclare var google: any; /**** See google is declared here ****/\n\n@IonicPage()\n@Component({\n  selector: 'page-location',\n  templateUrl: 'location.html',\n})\nexport class LocationPage {\n\n    @ViewChild('map') mapElement: ElementRef;\n    @ViewChild('searchbar', { read: ElementRef }) searchbar: ElementRef;\n    addressElement: HTMLInputElement = null;\n  \n    map: any;\n    address = '';\n  \n    constructor(public navCtrl: NavController,\n      public geolocation: Geolocation,\n      public zone: NgZone,\n      public platform: Platform,\n      public localStorage: Storage,\n      public mapService: MapProvider,\n      public spinner: SpinnerProvider,\n      public viewCtrl: ViewController,\n      public navParams: NavParams) \n    {\n        this.platform.ready().then(() => this.loadMaps());\n    }\n  \n    loadMaps() {\n      if (!!google) {\n        this.initializeMap();\n      } else {\n        this.errorAlert('Error', 'Something went wrong with the Internet Connection. Please check your Internet.')\n      }\n    }\n  \n    initializeMap() {\n      this.spinner.load();\n      let latLangObj = this.localStorage.get('current_latlong');\n\n      if(latLangObj == null) {\n        latLangObj = this.currentLocation();\n      }\n\n      latLangObj.then((resp) => {\n        if(resp != null)\n        {\n          let latLng: any;\n          if(resp.latitude != null) {\n            latLng = new google.maps.LatLng(resp.latitude, resp.longitude);\n          }\n          else {\n            let jsonObj = JSON.parse(resp);\n            latLng = new google.maps.LatLng(jsonObj.lat, jsonObj.long);\n          }\n\n          let mapOptions = {\n            center: latLng,\n            zoom: 15,\n            mapTypeId: google.maps.MapTypeId.ROADMAP,\n            gestureHandling: 'none',\n            mapTypeControl: false,\n            streetViewControl: false\n          }\n\n          this.zone.run(() => {\n            var mapEle = this.mapElement.nativeElement;\n            this.map = new google.maps.Map(mapEle, mapOptions);\n            \n            let latLngObj: any;\n            if(resp.latitude != null) {\n              latLngObj = {'lat': resp.latitude, 'long': resp.longitude};\n            }\n            else {\n              latLngObj = resp;\n            }\n            this.localStorage.set('current_latlong', JSON.stringify(latLngObj));\n\n            this.addMarker();\n            this.getAddress(latLngObj);\n            this.initAutocomplete();\n            this.spinner.dismiss();\n          });\n        }\n      }).catch((err) => { console.log(\"Error intializeMap\" + err)} );\n    }\n  \n    addMarker() {\n      let marker = new google.maps.Marker({\n        map: this.map,\n        position: this.map.getCenter(),\n        animation: google.maps.Animation.DROP,\n        title: 'My current location'\n      });\n      console.log(\"Marker \" + marker);\n    }\n\n    initAutocomplete(): void {\n      this.addressElement = this.searchbar.nativeElement.querySelector('.searchbar-input');\n      this.createAutocomplete(this.addressElement).subscribe((location) => {\n        let latLngObj = {'lat': location.lat(), 'long': location.lng()};\n        this.getAddress(latLngObj);\n        let options = {\n          center: location,\n          zoom: 16\n        };\n        this.map.setOptions(options);\n      });\n    }\n  \n    currentLocation() : Promise<any> {\n      //this.spinner.load();\n      return this.geolocation.getCurrentPosition().then((position) => position.coords);\n      /*{\n        let latLng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);\n        console.log(JSON.stringify(latLng));\n        let latLngObj = {'lat': position.coords.latitude, 'long': position.coords.longitude};\n        // Display  Marker\n        this.map.setCenter(latLng);\n        this.getAddress(latLngObj);\n        this.spinner.dismiss();\n        this.localStorage.set('current_latlong', JSON.stringify(latLngObj));\n        return latLngObj;\n\n      });*/\n    }\n  \n    getAddress(latLngObj) {\n      // Get the address object based on latLngObj\n      this.mapService.getStreetAddress(latLngObj).subscribe(\n        s_address => {\n          if (s_address.status == \"ZERO_RESULTS\") {\n            this.mapService.getAddress(latLngObj).subscribe(\n              address => {\n                if(address.results[0] != null) {\n                  this.address = address.results[0].formatted_address;\n                  this.getAddressComponentByPlace(address.results[0], latLngObj);\n                }\n              },\n              err => console.log(\"Error in getting the street address \" + err)\n            )\n          } else {\n            if(s_address.results[0] != null) {\n              this.address = s_address.results[0].formatted_address;\n              this.getAddressComponentByPlace(s_address.results[0], latLngObj);\n            }\n          }\n        },\n        err => {\n          console.log('No Address found ' + err);\n        }\n      );\n    }\n  \n    getMapCenter(){\n      return this.map.getCenter()\n    }\n  \n    createAutocomplete(addressEl: HTMLInputElement): Observable<any> {\n      const autocomplete = new google.maps.places.Autocomplete(addressEl);\n      autocomplete.bindTo('bounds', this.map);\n      return new Observable((sub: any) => {\n        google.maps.event.addListener(autocomplete, 'place_changed', () => {\n          const place = autocomplete.getPlace();\n          if (!place.geometry) {\n            sub.error({\n              message: 'Autocomplete returned place with no geometry'\n            });\n          } else {\n            let latLngObj = {'lat': place.geometry.location.lat(), 'long': place.geometry.location.lng()}\n            this.getAddress(latLngObj);\n            sub.next(place.geometry.location);\n          }\n        });\n      });\n    }\n  \n    getAddressComponentByPlace(place, latLngObj) {\n      var components;\n  \n      components = {};\n  \n      for(var i = 0; i < place.address_components.length; i++){\n        let ac = place.address_components[i];\n        components[ac.types[0]] = ac.long_name;\n      }\n      console.log(JSON.stringify(components));\n      /*let addressObj = {\n        street: (components.street_number) ? components.street_number : 'not found',\n        area: components.route,\n        city: (components.sublocality_level_1) ? components.sublocality_level_1 : components.locality,\n        country: (components.administrative_area_level_1) ? components.administrative_area_level_1 : components.political,\n        postCode: components.postal_code,\n        loc: [latLngObj.long, latLngObj.lat],\n        address: this.address\n      }*/\n      this.address = (components.sublocality_level_1) ? components.sublocality_level_1 : components.locality;\n      this.localStorage.set('current_city', (components.sublocality_level_1) ? components.sublocality_level_1 : components.locality);\n      return components;\n    }\n  \n    resizeMap() {\n      setTimeout(() => {\n        google.maps.event.trigger(this.map, 'resize');\n      }, 200);\n    }\n  \n    closeModal() {\n      this.viewCtrl.dismiss();\n    }\n  \n    errorAlert(title, message) {\n      alert('Error in Alert');\n    }\n  \n    navDealsListPage() {\n      this.navCtrl.push(\"DealsListPage\")\n    }\n  \n  }\n\n\n// WEBPACK FOOTER //\n// ./src/pages/location/location.ts"],"sourceRoot":""}