{"version":3,"sources":["../../src/pages/location/location.module.ts","../../src/pages/location/location.ts"],"names":[],"mappings":"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","file":"10.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { LocationPage } from './location';\n\n@NgModule({\n  declarations: [\n    LocationPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(LocationPage),\n  ],\n})\nexport class LocationPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/location/location.module.ts","import { Component, ViewChild, ElementRef, NgZone } from '@angular/core';\nimport { IonicPage, NavController, NavParams, ViewController, Platform } from 'ionic-angular';\nimport { Geolocation } from '@ionic-native/geolocation';\n\nimport { Observable } from 'rxjs/Observable';\nimport { Storage } from '@ionic/storage';\nimport { SpinnerProvider } from '../../providers/spinner/spinner'\nimport { MapProvider } from '../../providers/map/map';\n\ndeclare var google: any; /**** See google is declared here ****/\n\n@IonicPage()\n@Component({\n  selector: 'page-location',\n  templateUrl: 'location.html',\n})\nexport class LocationPage {\n\n    @ViewChild('map') mapElement: ElementRef;\n    @ViewChild('searchbar', { read: ElementRef }) searchbar: ElementRef;\n    addressElement: HTMLInputElement = null;\n  \n    map: any;\n    address = '';\n  \n    constructor(public navCtrl: NavController,\n      public geolocation: Geolocation,\n      public zone: NgZone,\n      public platform: Platform,\n      public localStorage: Storage,\n      public mapService: MapProvider,\n      public spinner: SpinnerProvider,\n      public viewCtrl: ViewController,\n      public navParams: NavParams) {\n        this.platform.ready().then(() => this.loadMaps());\n    }\n  \n    ionViewDidLoad() {\n      console.log('ionViewDidLoad MapPage');\n    }\n  \n    loadMaps() {\n      if (!!google) {\n        this.initializeMap();\n        this.initAutocomplete();\n      } else {\n        this.errorAlert('Error', 'Something went wrong with the Internet Connection. Please check your Internet.')\n      }\n    }\n  \n    initializeMap() {\n      let that = this;\n      let userLatLangObj = that.currentLocation();\n      this.zone.run(() => {\n        var mapEle = this.mapElement.nativeElement;\n        this.map = new google.maps.Map(mapEle, {\n          zoom: 16,\n          center: { lat: 0, lng: 0 }\n        });\n        let marker = new google.maps.Marker({\n          position: userLatLangObj,\n          map: this.map,\n          title: 'My current location'\n        });\n        console.log(marker);\n      });\n    }\n  \n    initAutocomplete(): void {\n      this.addressElement = this.searchbar.nativeElement.querySelector('.searchbar-input');\n      this.createAutocomplete(this.addressElement).subscribe((location) => {\n        console.log('Searchdata', location);\n        let latLngObj = {'lat': location.lat(), 'long': location.lng()};\n        this.getAddress(latLngObj);\n        let options = {\n          center: location,\n          zoom: 16\n        };\n        this.map.setOptions(options);\n      });\n    }\n  \n    currentLocation() {\n      this.spinner.load();\n      this.geolocation.getCurrentPosition().then((position) => {\n        let latLng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);\n        console.log(JSON.stringify(latLng));\n        let latLngObj = {'lat': position.coords.latitude, 'long': position.coords.longitude};\n        // Display  Marker\n        this.map.setCenter(new google.maps.LatLng(position.coords.latitude, position.coords.longitude));\n        this.getAddress(latLngObj);\n        this.spinner.dismiss();\n        localStorage.setItem('current_latlong', JSON.stringify(latLngObj));\n        return latLngObj;\n  \n      }, (err) => {\n        console.log(err);\n      });\n    }\n  \n    getAddress(latLngObj) {\n      // Get the address object based on latLngObj\n      this.mapService.getStreetAddress(latLngObj).subscribe(\n        s_address => {\n          if (s_address.status == \"ZERO_RESULTS\") {\n            this.mapService.getAddress(latLngObj).subscribe(\n              address => {\n                this.address = address.results[0].formatted_address;\n                this.getAddressComponentByPlace(address.results[0], latLngObj);\n              },\n              err => console.log(\"Error in getting the street address \" + err)\n            )\n          } else {\n            this.address = s_address.results[0].formatted_address;\n            this.getAddressComponentByPlace(s_address.results[0], latLngObj);\n            console.log(this.address);\n          }\n        },\n        err => {\n          console.log('No Address found ' + err);\n        }\n      );\n    }\n  \n    getMapCenter(){\n      return this.map.getCenter()\n    }\n  \n    createAutocomplete(addressEl: HTMLInputElement): Observable<any> {\n      const autocomplete = new google.maps.places.Autocomplete(addressEl);\n      autocomplete.bindTo('bounds', this.map);\n      return new Observable((sub: any) => {\n        google.maps.event.addListener(autocomplete, 'place_changed', () => {\n          const place = autocomplete.getPlace();\n          if (!place.geometry) {\n            sub.error({\n              message: 'Autocomplete returned place with no geometry'\n            });\n          } else {\n            let latLngObj = {'lat': place.geometry.location.lat(), 'long': place.geometry.location.lng()}\n            this.getAddress(latLngObj);\n            sub.next(place.geometry.location);\n          }\n        });\n      });\n    }\n  \n    getAddressComponentByPlace(place, latLngObj) {\n      var components;\n  \n      components = {};\n  \n      for(var i = 0; i < place.address_components.length; i++){\n        let ac = place.address_components[i];\n        components[ac.types[0]] = ac.long_name;\n      }\n  \n      let addressObj = {\n        street: (components.street_number) ? components.street_number : 'not found',\n        area: components.route,\n        city: (components.sublocality_level_1) ? components.sublocality_level_1 : components.locality,\n        country: (components.administrative_area_level_1) ? components.administrative_area_level_1 : components.political,\n        postCode: components.postal_code,\n        loc: [latLngObj.long, latLngObj.lat],\n        address: this.address\n      }\n      localStorage.clear();\n      localStorage.setItem('carryr_customer', JSON.stringify(addressObj));\n      this.localStorage.set('current_city', (components.sublocality_level_1) ? components.sublocality_level_1 : components.locality);\n      return components;\n    }\n  \n    resizeMap() {\n      setTimeout(() => {\n        google.maps.event.trigger(this.map, 'resize');\n      }, 200);\n    }\n  \n    closeModal() {\n      this.viewCtrl.dismiss();\n    }\n  \n    errorAlert(title, message) {\n      alert('Error in Alert');\n    }\n  \n    navDealsListPage() {\n      this.navCtrl.push(\"DealsListPage\")\n    }\n  \n  }\n\n\n// WEBPACK FOOTER //\n// ./src/pages/location/location.ts"],"sourceRoot":""}